

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>gameclasses &mdash; Decenalized Decision Making 1b6f5e3 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/graphviz.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> Decenalized Decision Making
          

          
          </a>

          
            
            
              <div class="version">
                0.3.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../run_samples.html">Judgmnet Call and Game Sample interdepndent network</a></li>
<li class="toctree-l1"><a class="reference internal" href="../run_main.html">Runs INDP, td-INDP, Judgment Call, and infrastructure games</a></li>
<li class="toctree-l1"><a class="reference internal" href="../backend.html">Backend Classes and Modules</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Decenalized Decision Making</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="index.html">Module code</a> &raquo;</li>
        
      <li>gameclasses</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for gameclasses</h1><div class="highlight"><pre>
<span></span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">This module contain the classes used for game theoritical analysis of interdpendent</span>
<span class="sd">network restoration</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">itertools</span>
<span class="kn">import</span> <span class="nn">fractions</span>
<span class="kn">import</span> <span class="nn">scipy</span>
<span class="kn">import</span> <span class="nn">pickle</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">dindpclasses</span>
<span class="kn">import</span> <span class="nn">indpalt</span>
<span class="kn">import</span> <span class="nn">indp</span>
<span class="kn">import</span> <span class="nn">indputils</span>
<span class="kn">import</span> <span class="nn">plots</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">gambit</span>
<span class="k">except</span> <span class="ne">ModuleNotFoundError</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Can&#39;t find module &#39;gambit&#39;&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="NormalGame"><a class="viewcode-back" href="../gameclasses.html#gameclasses.NormalGame">[docs]</a><span class="k">class</span> <span class="nc">NormalGame</span><span class="p">:</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    This class models a normal (strategic) restoration game for a given time step </span>
<span class="sd">    and finds pure and mixed strategy nash equilibria.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    players : list</span>
<span class="sd">        List of players, set based on &#39;L&#39; from input variables of :class:`NormalGame`</span>
<span class="sd">    net : :class:`~infrastructure.InfrastructureNetwork`</span>
<span class="sd">        Object that stores network information, set based on &#39;net&#39; from input variables</span>
<span class="sd">        of :class:`NormalGame`</span>
<span class="sd">    v_r : dict</span>
<span class="sd">        Dictionary that stores the number of available resources, :math:`R_c`, for</span>
<span class="sd">        the current time step, set based on &#39;v_r&#39; from input variables of :class:`NormalGame` </span>
<span class="sd">    dependee_nodes : dict</span>
<span class="sd">        Dictionary of all dependee nodes in the network</span>
<span class="sd">    actions : dict</span>
<span class="sd">        Dictionary of all relavant restoration actions (including &#39;No Action (NA)&#39; and</span>
<span class="sd">        possibly &#39;Other Action (OA)&#39;), which are used as the possible moves by players,</span>
<span class="sd">        set by :meth:`find_actions`</span>
<span class="sd">    first_actions : list</span>
<span class="sd">        List of first action of each player in :attr:`actions`, which is sed to check if</span>
<span class="sd">        any action is left for any one the players.</span>
<span class="sd">    actions_reduced : bool</span>
<span class="sd">        Provisional: If true, actions for at least one agent are more than 1000 and hence are reduced</span>
<span class="sd">    payoffs : dict</span>
<span class="sd">        Dictionary of payoffs for all possible action profiles, calculated by solving </span>
<span class="sd">        INDP or the corresponfing flow problem. It is populated by :meth:`compute_payoffs`.</span>
<span class="sd">    payoff_time : dict</span>
<span class="sd">        Time to compute each entry in :attr:`payoffs`</span>
<span class="sd">    solving_time : float</span>
<span class="sd">        Time to solve the game using :meth:`solve_game`</span>
<span class="sd">    normgame : :class:`gambit.Game`</span>
<span class="sd">        Normal game object defined by gambit. It is populated by :meth:`build_game`.</span>
<span class="sd">    solution : :class:`GameSolution`</span>
<span class="sd">        Solution of the normal game. It is populated by :meth:`solve_game`.</span>
<span class="sd">    chosen_equilibrium : dict</span>
<span class="sd">        Action chosen from Nash equilibria (if there are more than one) as</span>
<span class="sd">        the action of the current time step to proceed to the next step. It is</span>
<span class="sd">        populated by :meth:`choose_equilibrium`.\n</span>
<span class="sd">        The solution is the one with lowest total cost assuming that after many games</span>
<span class="sd">        (as supposed in NE) people know which one has the overall lowest total cost.</span>
<span class="sd">        If there are more than one minimum total cost equilibrium, one of them is </span>
<span class="sd">        chosen randomly. \n</span>
<span class="sd">        If the chosen NE is a mixed strategy, the mixed strategy with the highest</span>
<span class="sd">        probability is chosen. If there are more than one of such mixed strategy,</span>
<span class="sd">        then one of them is chosen randomly</span>

<span class="sd">        .. todo::</span>
<span class="sd">            Games: refine the way the game solution is chosen in each time step</span>
<span class="sd">    optimal_solution : dict</span>
<span class="sd">        Optimal Solution from INDP. It is populated by :meth:`find_optimal_solution`.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">net</span><span class="p">,</span> <span class="n">v_r</span><span class="p">,</span> <span class="n">act_rduc</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">players</span> <span class="o">=</span> <span class="n">L</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">net</span> <span class="o">=</span> <span class="n">net</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">v_r</span> <span class="o">=</span> <span class="n">v_r</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dependee_nodes</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actions_reduced</span> <span class="o">=</span> <span class="n">act_rduc</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_actions</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">first_actions</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">actions</span><span class="p">[</span><span class="n">l</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">payoffs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">payoff_time</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">solving_time</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">normgame</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">solution</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">chosen_equilibrium</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">optimal_solution</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">__getstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return state values to be pickled. Gambit game object is deleted when</span>
<span class="sd">        pickling. To retirve it, user should save the game to file when building </span>
<span class="sd">        the game and read it later and add it to to the unpickled object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">state</span><span class="p">[</span><span class="s2">&quot;normgame&quot;</span><span class="p">]</span> <span class="o">=</span>  <span class="p">{}</span>
        <span class="k">return</span> <span class="n">state</span>

    <span class="k">def</span> <span class="nf">__setstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Restore state from the unpickled state values. Gambit game object is deleted when</span>
<span class="sd">        pickling. To retirve it, user should save the game to file when building </span>
<span class="sd">        the game and read it later and add it to to the unpickled object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>

<div class="viewcode-block" id="NormalGame.find_actions"><a class="viewcode-back" href="../gameclasses.html#gameclasses.NormalGame.find_actions">[docs]</a>    <span class="k">def</span> <span class="nf">find_actions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        This function finds all relevant restoration actions for each player</span>
<span class="sd">        </span>
<span class="sd">        .. todo::</span>
<span class="sd">            Games: Add the geographical interdependency to find actions, which means</span>
<span class="sd">            to consider the arc repaires as indepndent actions rather than aggregate </span>
<span class="sd">            them in the &#39;OA&#39; action.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        actions : dict</span>
<span class="sd">            Dictionary of all relavant restoration actions.</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">for</span> <span class="n">u</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">net</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">edges</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">a</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;inf_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">is_interdep</span> <span class="ow">and</span> <span class="n">u</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span> <span class="ow">and</span> <span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">u</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dependee_nodes</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">dependee_nodes</span><span class="p">[</span><span class="n">u</span><span class="p">]</span><span class="o">=</span><span class="p">[]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dependee_nodes</span><span class="p">[</span><span class="n">u</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">v</span><span class="p">,</span><span class="n">a</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;inf_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">gamma</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">actions_reduced</span> <span class="o">==</span> <span class="s1">&#39;EDM&#39;</span><span class="p">:</span>
            <span class="n">v_r</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="n">x</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">v_r</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span>
            <span class="n">indp_res</span> <span class="o">=</span> <span class="n">indp</span><span class="o">.</span><span class="n">indp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">net</span><span class="p">,</span> <span class="n">v_r</span><span class="o">=</span><span class="n">v_r</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">layers</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="p">,</span>
                                 <span class="n">controlled_layers</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="p">,</span> <span class="n">functionality</span><span class="o">=</span><span class="p">{},</span>
                                 <span class="n">print_cmd</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">solution_pool</span><span class="o">=</span><span class="mi">100</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">solution_pool</span><span class="o">=</span><span class="p">{</span><span class="n">l</span><span class="p">:[]</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="p">}</span>
            <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">indp_res</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="p">:</span>
                    <span class="n">act</span> <span class="o">=</span> <span class="p">()</span>
                    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">val</span><span class="p">[</span><span class="s1">&#39;nodes&#39;</span><span class="p">]:</span>
                        <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="n">l</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dependee_nodes</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                                <span class="n">act</span> <span class="o">+=</span> <span class="p">(</span><span class="n">x</span><span class="p">,)</span>
                            <span class="k">elif</span> <span class="p">(</span><span class="s1">&#39;OA&#39;</span><span class="p">,</span><span class="n">l</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">act</span><span class="p">:</span>
                                <span class="n">act</span> <span class="o">+=</span> <span class="p">((</span><span class="s1">&#39;OA&#39;</span><span class="p">,</span><span class="n">l</span><span class="p">),)</span>
                    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">val</span><span class="p">[</span><span class="s1">&#39;arcs&#39;</span><span class="p">]:</span>
                        <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="n">l</span> <span class="ow">and</span> <span class="p">(</span><span class="s1">&#39;OA&#39;</span><span class="p">,</span><span class="n">l</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">act</span><span class="p">:</span>
                            <span class="n">act</span> <span class="o">+=</span> <span class="p">((</span><span class="s1">&#39;OA&#39;</span><span class="p">,</span><span class="n">l</span><span class="p">),)</span>
                    <span class="k">if</span> <span class="n">act</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">solution_pool</span><span class="p">[</span><span class="n">l</span><span class="p">]:</span>
                        <span class="n">solution_pool</span><span class="p">[</span><span class="n">l</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">act</span><span class="p">)</span>
        <span class="n">actions</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="p">:</span>
            <span class="n">damaged_nodes</span> <span class="o">=</span> <span class="p">[</span><span class="n">n</span> <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">net</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">if</span>\
                        <span class="n">d</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;inf_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">functionality</span> <span class="o">==</span> <span class="mf">0.0</span> <span class="ow">and</span> <span class="n">n</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">l</span><span class="p">]</span>
            <span class="n">damaged_arcs</span> <span class="o">=</span> <span class="p">[(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">net</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">edges</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">if</span>\
                        <span class="n">a</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;inf_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">functionality</span> <span class="o">==</span> <span class="mf">0.0</span> <span class="ow">and</span> <span class="n">u</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">l</span> <span class="ow">and</span> <span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">l</span><span class="p">]</span>
            <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            Arc repaire actions are collected under &quot;other action (OA)&quot; since</span>
<span class="sd">            the arc actions do not affect the decision of other palyers</span>
<span class="sd">            &#39;&#39;&#39;</span>
            <span class="n">other_action</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">damaged_arcs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">other_action</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            Non-depndeee node repaire actions are collected under &quot;other action (OA)&quot;</span>
<span class="sd">            since these actions do not affect the decision of other palyers</span>
<span class="sd">            &#39;&#39;&#39;</span>
            <span class="n">rel_actions</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">damaged_nodes</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">n</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dependee_nodes</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="n">rel_actions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">other_action</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="n">other_action</span><span class="p">:</span>
                <span class="n">rel_actions</span><span class="o">.</span><span class="n">extend</span><span class="p">([(</span><span class="s1">&#39;OA&#39;</span><span class="p">,</span><span class="n">l</span><span class="p">)])</span>
            <span class="n">actions</span><span class="p">[</span><span class="n">l</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">v_r</span><span class="p">[</span><span class="n">l</span><span class="p">]):</span>
                <span class="n">actions</span><span class="p">[</span><span class="n">l</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">combinations</span><span class="p">(</span><span class="n">rel_actions</span><span class="p">,</span> <span class="n">v</span><span class="o">+</span><span class="mi">1</span><span class="p">)))</span>
            <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            &quot;No Action (NA)&quot; is added to possible actions</span>
<span class="sd">            &#39;&#39;&#39;</span>
            <span class="n">actions</span><span class="p">[</span><span class="n">l</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">([(</span><span class="s1">&#39;NA&#39;</span><span class="p">,</span><span class="n">l</span><span class="p">)])</span>
            
            <span class="sd">&#39;&#39;&#39; Remove action due to the biunded rationality &#39;&#39;&#39;</span>
            <span class="n">remove_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">actions_reduced</span> <span class="o">==</span> <span class="s1">&#39;ER&#39;</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">actions</span><span class="p">[</span><span class="n">l</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">v_r</span><span class="p">[</span><span class="n">l</span><span class="p">]</span> <span class="ow">and</span> <span class="p">(</span><span class="s1">&#39;OA&#39;</span><span class="p">,</span><span class="n">l</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">a</span> <span class="ow">and</span> <span class="n">a</span> <span class="o">!=</span> <span class="p">(</span><span class="s1">&#39;NA&#39;</span><span class="p">,</span><span class="n">l</span><span class="p">):</span>
                        <span class="n">remove_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">actions_reduced</span> <span class="o">==</span> <span class="s1">&#39;EDM&#39;</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">actions</span><span class="p">[</span><span class="n">l</span><span class="p">]:</span>
                    <span class="n">is_in_sol_pool</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="k">if</span> <span class="n">a</span> <span class="o">!=</span> <span class="p">(</span><span class="s1">&#39;NA&#39;</span><span class="p">,</span><span class="n">l</span><span class="p">):</span>
                        <span class="n">sa</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">item</span><span class="p">:</span><span class="nb">str</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">])))</span>
                        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">solution_pool</span><span class="p">[</span><span class="n">l</span><span class="p">]:</span>
                            <span class="n">sx</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">item</span><span class="p">:</span><span class="nb">str</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">])))</span>
                            <span class="k">if</span> <span class="n">sa</span> <span class="o">==</span> <span class="n">sx</span><span class="p">:</span>
                                <span class="n">is_in_sol_pool</span> <span class="o">=</span> <span class="kc">True</span>
                                <span class="k">break</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_in_sol_pool</span><span class="p">:</span>
                            <span class="n">remove_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
            <span class="n">actions</span><span class="p">[</span><span class="n">l</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">actions</span><span class="p">[</span><span class="n">l</span><span class="p">]</span> <span class="k">if</span> <span class="n">a</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">remove_list</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">actions</span></div>

<div class="viewcode-block" id="NormalGame.compute_payoffs"><a class="viewcode-back" href="../gameclasses.html#gameclasses.NormalGame.compute_payoffs">[docs]</a>    <span class="k">def</span> <span class="nf">compute_payoffs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">save_model</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">payoff_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        This function finds all possible combinations of actions and their corresponding</span>
<span class="sd">        payoffs considering resource limitations</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        save_model : list, optional</span>
<span class="sd">            The folder name and the current time step, which are needed to create</span>
<span class="sd">            the folder that contains INDP models for computing payoffs. The default</span>
<span class="sd">            is None, which prevent saving models to file.</span>
<span class="sd">        payoff_dir : list, optional</span>
<span class="sd">            Address to the file containing past results including payoff values</span>
<span class="sd">            for the first time step. For other time steps, the payoff value may </span>
<span class="sd">            have been computed based on different initial conditions. The default</span>
<span class="sd">            is None.</span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        :</span>
<span class="sd">            None.</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">actions_super_set</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">memory_threshold</span> <span class="o">=</span>  <span class="mi">5000</span>
        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="p">:</span>
            <span class="n">actions_super_set</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
            <span class="n">actions_super_set</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">actions</span><span class="p">[</span><span class="n">l</span><span class="p">])</span>
        <span class="n">action_comb</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="o">*</span><span class="n">actions_super_set</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">payoff_dir</span><span class="p">:</span>
            <span class="c1"># Read payoffs for each possible combinations of actions</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">payoff_dir</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">obj_file</span><span class="p">:</span>
                <span class="n">past_obj</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">obj_file</span><span class="p">)</span>
            <span class="n">obj_1</span> <span class="o">=</span> <span class="n">past_obj</span><span class="o">.</span><span class="n">objs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">actions</span> <span class="o">=</span> <span class="n">obj_1</span><span class="o">.</span><span class="n">actions</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">v_r</span> <span class="o">=</span> <span class="n">obj_1</span><span class="o">.</span><span class="n">v_r</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">payoffs</span> <span class="o">=</span> <span class="n">obj_1</span><span class="o">.</span><span class="n">payoffs</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">payoff_time</span> <span class="o">=</span> <span class="n">obj_1</span><span class="o">.</span><span class="n">payoff_time</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># compute payoffs for each possible combinations of actions</span>
            <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">ac</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">action_comb</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">payoffs</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">flow_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">flow_problem</span><span class="p">(</span><span class="n">ac</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">flow_results</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">save_model</span><span class="p">:</span>
                        <span class="n">indp</span><span class="o">.</span><span class="n">save_INDP_model_to_file</span><span class="p">(</span><span class="n">flow_results</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">save_model</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                                     <span class="n">save_model</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">suffix</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">ac</span><span class="p">))</span>
                    <span class="k">for</span> <span class="n">idxl</span><span class="p">,</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="p">):</span>
                        <span class="c1"># Minus sign because we want to minimize the cost</span>
                        <span class="n">payoff_layer</span> <span class="o">=</span> <span class="o">-</span><span class="n">flow_results</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">results_layer</span><span class="p">[</span><span class="n">l</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;costs&#39;</span><span class="p">][</span><span class="s1">&#39;Total&#39;</span><span class="p">]</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">payoffs</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="n">l</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">ac</span><span class="p">[</span><span class="n">idxl</span><span class="p">],</span> <span class="n">payoff_layer</span><span class="p">]</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">payoff_time</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">flow_results</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;run_time&#39;</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">idxl</span><span class="p">,</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="p">):</span>
                        <span class="n">payoff_layer</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1e100</span> <span class="c1">#!!! Change this to work for general case</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">payoffs</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="n">l</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">ac</span><span class="p">[</span><span class="n">idxl</span><span class="p">],</span> <span class="n">payoff_layer</span><span class="p">]</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">payoff_time</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">action_comb</span><span class="p">)</span><span class="o">&gt;</span><span class="n">memory_threshold</span> <span class="ow">and</span> <span class="n">idx</span><span class="o">%</span><span class="n">memory_threshold</span><span class="o">==</span><span class="mi">0</span> <span class="ow">and</span> <span class="n">idx</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">idx</span><span class="o">//</span><span class="n">memory_threshold</span><span class="p">),</span> <span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">memory_threshold</span><span class="p">))</span></div>
                <span class="c1">#     temp_dir = &#39;./temp_payoff_objs&#39;</span>
                <span class="c1">#     if not os.path.exists(temp_dir):</span>
                <span class="c1">#         os.makedirs(temp_dir)</span>
                <span class="c1">#     with open(temp_dir+&#39;/temp_payoff_obj_&#39;+str(idx//memory_threshold)+&#39;.pkl&#39;, &#39;wb&#39;) as output:</span>
                <span class="c1">#         pickle.dump(self, output, pickle.HIGHEST_PROTOCOL)</span>
                <span class="c1">#         self.payoffs = {}</span>
                <span class="c1">#         self.payoff_time = {}</span>
<div class="viewcode-block" id="NormalGame.flow_problem"><a class="viewcode-back" href="../gameclasses.html#gameclasses.NormalGame.flow_problem">[docs]</a>    <span class="k">def</span> <span class="nf">flow_problem</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">action</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Solves a flow problem for a given combination of actions</span>

<span class="sd">        Damaged arc repairs and damage, non-dependee node repairs are removed</span>
<span class="sd">        from actions, and collected under &quot;Other Action (OA)&quot; since they do not</span>
<span class="sd">        affect other agents&#39; actions.</span>

<span class="sd">        To find OA payoff, I solve an INDP problem with fixed node values. For</span>
<span class="sd">        example, assume player 1&#39;s relevant damaged nodes (damaged, dependee node)</span>
<span class="sd">        are :math:`[1, 2, 3]`. Also, player 2&#39;s relevant damaged nodes are</span>
<span class="sd">        :math:`[4, 5, 6]`. For an action profile :math:`\{[1, OA], [5, 6, OA]\}`,</span>
<span class="sd">        I set :math:`1` to be repaired and :math:`2,3` to stay damaged. Similarly,</span>
<span class="sd">        I set :math:`5,6` to to be repaired, and :math:`4` to stay damaged.</span>
<span class="sd">        Then, I solve INDP under these restrictions.</span>

<span class="sd">        Also, I restrict the number of resources for each layer. Say, if 2 resources</span>
<span class="sd">        are available for each layer (i.e. :math:`R_c=2`), I impose this restriction too.</span>
<span class="sd">        Effectively, in solving INDP for player 1, I assume that :math:`1` is repaired,</span>
<span class="sd">        :math:`2,3` must not be repaired, and the repair of non-relevant elements are</span>
<span class="sd">        decided by INDP.</span>

<span class="sd">        Furthermore, if there are, for example, :math:`R_c=3` for each player, but</span>
<span class="sd">        the action profile is :math:`\{[1], [5, 6]\}`, then I solve INDP by restricting</span>
<span class="sd">        :math:`R_c` to 1 for player 1 and to 2 for player 2. Therefore, I make sure that</span>
<span class="sd">        only the nodes in the action profile are considered repaired.</span>

<span class="sd">        Moreover, by removing arcs from the actions, I am ignoring the geographical</span>
<span class="sd">        interdependency among layers.</span>

<span class="sd">        .. todo::</span>
<span class="sd">            Games: Add the geographical interdependency to computation of payoff values</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        action : tuple</span>
<span class="sd">            Action profile for which the payoff is computed.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        :</span>
<span class="sd">            None.</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">adjusted_v_r</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span><span class="n">val</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">v_r</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
        <span class="n">fixed_nodes</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dependee_nodes</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">net</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">u</span><span class="p">][</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;inf_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">functionality</span> <span class="o">!=</span> <span class="mf">1.0</span><span class="p">:</span>
                <span class="n">fixed_nodes</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">for</span> <span class="n">idxl</span><span class="p">,</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">action</span><span class="p">[</span><span class="n">idxl</span><span class="p">]</span> <span class="o">!=</span> <span class="p">(</span><span class="s1">&#39;NA&#39;</span><span class="p">,</span><span class="n">l</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">act</span> <span class="ow">in</span> <span class="n">action</span><span class="p">[</span><span class="n">idxl</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="n">act</span> <span class="o">!=</span> <span class="p">(</span><span class="s1">&#39;OA&#39;</span><span class="p">,</span><span class="n">l</span><span class="p">):</span>
                        <span class="n">fixed_nodes</span><span class="p">[</span><span class="n">act</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
                <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;OA&#39;</span><span class="p">,</span><span class="n">l</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">action</span><span class="p">[</span><span class="n">idxl</span><span class="p">]:</span>
                    <span class="n">adjusted_v_r</span><span class="p">[</span><span class="n">l</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">action</span><span class="p">[</span><span class="n">idxl</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">adjusted_v_r</span><span class="p">[</span><span class="n">l</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">flow_results</span> <span class="o">=</span> <span class="n">indp</span><span class="o">.</span><span class="n">indp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">net</span><span class="p">,</span> <span class="n">v_r</span><span class="o">=</span><span class="n">adjusted_v_r</span><span class="p">,</span> <span class="n">layers</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="p">,</span>
                                 <span class="n">controlled_layers</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="p">,</span> <span class="n">print_cmd</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                 <span class="n">time_limit</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fixed_nodes</span><span class="o">=</span><span class="n">fixed_nodes</span><span class="p">,</span>
                                 <span class="n">co_location</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">flow_results</span></div>

<div class="viewcode-block" id="NormalGame.build_game"><a class="viewcode-back" href="../gameclasses.html#gameclasses.NormalGame.build_game">[docs]</a>    <span class="k">def</span> <span class="nf">build_game</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">save_model</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        This function constructs the normal restoratuion game</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        save_model : str, optional</span>
<span class="sd">            Directory to which the game should be written as a .txt file. The default</span>
<span class="sd">            is None, which prevents writing to file.</span>
<span class="sd">        suffix : str, optional</span>
<span class="sd">            An optional suffix that is added to the file name. The default is &#39;&#39;.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        :</span>
<span class="sd">            None.</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">dimensions</span> <span class="o">=</span> <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">items</span><span class="p">()]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">normgame</span> <span class="o">=</span> <span class="n">gambit</span><span class="o">.</span><span class="n">Game</span><span class="o">.</span><span class="n">new_table</span><span class="p">(</span><span class="n">dimensions</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">idxl</span><span class="p">,</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">idxal</span><span class="p">,</span> <span class="n">al</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">actions</span><span class="p">[</span><span class="n">l</span><span class="p">]):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">normgame</span><span class="o">.</span><span class="n">players</span><span class="p">[</span><span class="n">idxl</span><span class="p">]</span><span class="o">.</span><span class="n">strategies</span><span class="p">[</span><span class="n">idxal</span><span class="p">]</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">al</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">ac</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">payoffs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">payoff_cell_corrdinate</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">keyl</span><span class="p">,</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">ac</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">payoff_cell_corrdinate</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
            <span class="k">for</span> <span class="n">keyl</span><span class="p">,</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">ac</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">keyl</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">normgame</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">payoff_cell_corrdinate</span><span class="p">)][</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">fractions</span><span class="o">.</span><span class="n">Fraction</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">save_model</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">save_model</span><span class="p">):</span>
                <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">save_model</span><span class="p">)</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">save_model</span><span class="o">+</span><span class="s1">&#39;/norm_game_&#39;</span><span class="o">+</span><span class="n">suffix</span><span class="o">+</span><span class="s2">&quot;.txt&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">text_file</span><span class="p">:</span>
                <span class="n">text_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">normgame</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">format</span><span class="o">=</span><span class="s1">&#39;native&#39;</span><span class="p">)[</span><span class="mi">2</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">n&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">))</span></div>

<div class="viewcode-block" id="NormalGame.solve_game"><a class="viewcode-back" href="../gameclasses.html#gameclasses.NormalGame.solve_game">[docs]</a>    <span class="k">def</span> <span class="nf">solve_game</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;enumerate_pure&#39;</span><span class="p">,</span> <span class="n">print_to_cmd</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> 
                   <span class="n">game_info</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        This function solves the normal restoration game given a solving method</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        method : str, optional</span>
<span class="sd">            Method to solve the normal game. The default is &#39;enumerate_pure&#39;.</span>
<span class="sd">            Options: enumerate_pure, enumerate_mixed_2p, linear_complementarity_2p,</span>
<span class="sd">            linear_programming_2p, simplicial_subdivision,</span>
<span class="sd">            iterated_polymatrix_approximation, global_newton_method</span>
<span class="sd">        print_to_cmd : bool, optional</span>
<span class="sd">            Should the found equilibria be written to console. The default is False.</span>
<span class="sd">        game_info :list, optional</span>
<span class="sd">            The list of information about the game that should be solved. The first</span>
<span class="sd">            item in the list is a class:`~gambit.Game` object similar to</span>
<span class="sd">            :py:attr:`~NormalGame.normgame`. The second item is  a list of players of</span>
<span class="sd">            the game similar to :py:attr:`~NormalGame.players`. The third item is a</span>
<span class="sd">            dictionary that contatins the actions of each player similar to</span>
<span class="sd">            :py:attr:`~NormalGame.actions`. The default is &#39;None&#39;, which is the</span>
<span class="sd">            equivalent of passing [self.normgame, self.players, self.actions].</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        :</span>
<span class="sd">            None.</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">game</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">normgame</span>
        <span class="n">player_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span>
        <span class="n">action_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">actions</span>
        <span class="k">if</span> <span class="n">game_info</span><span class="p">:</span>
            <span class="n">game</span> <span class="o">=</span> <span class="n">game_info</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">player_list</span> <span class="o">=</span> <span class="n">game_info</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">action_list</span> <span class="o">=</span> <span class="n">game_info</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

        <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">no_solution</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;enumerate_pure&#39;</span><span class="p">:</span>
            <span class="n">gambit_solution</span> <span class="o">=</span> <span class="n">gambit</span><span class="o">.</span><span class="n">nash</span><span class="o">.</span><span class="n">enumpure_solve</span><span class="p">(</span><span class="n">game</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;enumerate_mixed_2p&#39;</span><span class="p">:</span>
            <span class="n">gambit_solution</span> <span class="o">=</span> <span class="n">gambit</span><span class="o">.</span><span class="n">nash</span><span class="o">.</span><span class="n">enummixed_solve</span><span class="p">(</span><span class="n">game</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;linear_complementarity_2p&#39;</span><span class="p">:</span>
            <span class="n">gambit_solution</span> <span class="o">=</span> <span class="n">gambit</span><span class="o">.</span><span class="n">nash</span><span class="o">.</span><span class="n">lcp_solve</span><span class="p">(</span><span class="n">game</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;linear_programming_2p&#39;</span><span class="p">:</span>
            <span class="n">gambit_solution</span> <span class="o">=</span> <span class="n">gambit</span><span class="o">.</span><span class="n">nash</span><span class="o">.</span><span class="n">lp_solve</span><span class="p">(</span><span class="n">game</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;simplicial_subdivision&#39;</span><span class="p">:</span>
            <span class="n">gambit_solution</span> <span class="o">=</span> <span class="n">gambit</span><span class="o">.</span><span class="n">nash</span><span class="o">.</span><span class="n">simpdiv_solve</span><span class="p">(</span><span class="n">game</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;iterated_polymatrix_approximation&#39;</span><span class="p">:</span>
            <span class="n">gambit_solution</span> <span class="o">=</span> <span class="n">gambit</span><span class="o">.</span><span class="n">nash</span><span class="o">.</span><span class="n">ipa_solve</span><span class="p">(</span><span class="n">game</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;global_newton_method&#39;</span><span class="p">:</span>
            <span class="n">gambit_solution</span> <span class="o">=</span> <span class="n">gambit</span><span class="o">.</span><span class="n">nash</span><span class="o">.</span><span class="n">gnm_solve</span><span class="p">(</span><span class="n">game</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s1">&#39;The solution method is not valid&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">gambit_solution</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span> <span class="ow">and</span> <span class="n">method</span> <span class="o">!=</span> <span class="s1">&#39;enumerate_pure&#39;</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;No solution found: switching to pure enumeratiom method&#39;</span><span class="p">)</span>
            <span class="n">gambit_solution</span> <span class="o">=</span> <span class="n">gambit</span><span class="o">.</span><span class="n">nash</span><span class="o">.</span><span class="n">enumpure_solve</span><span class="p">(</span><span class="n">game</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">gambit_solution</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span> <span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;No pure Nash equilibrium - both choose randomly&#39;</span><span class="p">)</span>
            <span class="n">no_solution</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">solving_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="o">-</span><span class="n">start_time</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">solution</span> <span class="o">=</span> <span class="n">GameSolution</span><span class="p">(</span><span class="n">player_list</span><span class="p">,</span> <span class="n">gambit_solution</span><span class="p">,</span> <span class="n">action_list</span><span class="p">)</span>
        <span class="c1"># Choose a random action profile when there is no equilibrium</span>
        <span class="k">if</span> <span class="n">no_solution</span><span class="p">:</span>
            <span class="n">max_payoff</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1e100</span>
            <span class="k">while</span> <span class="n">max_payoff</span> <span class="o">==</span> <span class="o">-</span><span class="mf">1e100</span><span class="p">:</span>
                <span class="n">act_profile</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">payoffs</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
                <span class="n">max_payoff</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">act_profile</span><span class="o">.</span><span class="n">values</span><span class="p">()])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">solution</span><span class="o">.</span><span class="n">sol</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">:{}}</span>
            <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">player_list</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">solution</span><span class="o">.</span><span class="n">sol</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;P&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">l</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39; payoff&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">act_profile</span><span class="p">[</span><span class="n">l</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">solution</span><span class="o">.</span><span class="n">sol</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;P&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">l</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39; actions&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">act_profile</span><span class="p">[</span><span class="n">l</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">solution</span><span class="o">.</span><span class="n">sol</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;P&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">l</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39; action probs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">solution</span><span class="o">.</span><span class="n">sol</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;total cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="nb">sum</span><span class="p">([</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">act_profile</span><span class="o">.</span><span class="n">values</span><span class="p">()])</span>
        <span class="c1"># Find all combination of action in the case of mixed strategy</span>
        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">sol</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">solution</span><span class="o">.</span><span class="n">sol</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">sol_super_set</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">player_list</span><span class="p">:</span>
                <span class="n">sol_super_set</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sol</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">l</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39; actions&#39;</span><span class="p">])</span>
            <span class="n">sol</span><span class="p">[</span><span class="s1">&#39;solution combination&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="o">*</span><span class="n">sol_super_set</span><span class="p">))</span>
        <span class="c1"># Print to console</span>
        <span class="k">if</span> <span class="n">print_to_cmd</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;NE (pure or mixed) Solutions(s)&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">gambit_solution</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1">.&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">idx</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
                <span class="nb">print</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">x</span><span class="p">])</span>
                <span class="nb">print</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">x</span><span class="o">.</span><span class="n">payoff</span><span class="p">()])</span></div>

<div class="viewcode-block" id="NormalGame.choose_equilibrium"><a class="viewcode-back" href="../gameclasses.html#gameclasses.NormalGame.choose_equilibrium">[docs]</a>    <span class="k">def</span> <span class="nf">choose_equilibrium</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">preferred_players</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Choose one action frm pure or mixed strtegies</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        excluded_players : dict, optional</span>
<span class="sd">            The dictionary of player that should be included and excluded from NE</span>
<span class="sd">            choosing process. The default is None, which means all</span>
<span class="sd">            players are considered in choosing payoffs.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">preferred_players</span><span class="p">:</span>
            <span class="n">included_palyers</span> <span class="o">=</span> <span class="n">preferred_players</span><span class="p">[</span><span class="s1">&#39;included&#39;</span><span class="p">]</span>
            <span class="n">excluded_palyers</span> <span class="o">=</span> <span class="n">preferred_players</span><span class="p">[</span><span class="s1">&#39;excluded&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">included_palyers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span>
            <span class="n">excluded_palyers</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">total_cost_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">sol</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">solution</span><span class="o">.</span><span class="n">sol</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">exclude_payoffs</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="o">-</span><span class="n">sol</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39; payoff&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">excluded_palyers</span><span class="p">])</span>
            <span class="n">total_cost_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">sol</span><span class="p">[</span><span class="s1">&#39;total cost&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">exclude_payoffs</span>
        <span class="n">min_val</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">total_cost_dict</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
        <span class="n">min_keys</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">total_cost_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">v</span> <span class="o">==</span> <span class="n">min_val</span><span class="p">]</span>
        <span class="c1"># Chosse the lowest cost NE and randomize among several minimum values</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">min_keys</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">sol_key</span> <span class="o">=</span> <span class="n">min_keys</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sol_key</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">min_keys</span><span class="p">)</span>
        <span class="c1"># Chosse a ranodm action from the action profile if the chosen solution is a mixed NE</span>
        <span class="n">num_profile_actions</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">solution</span><span class="o">.</span><span class="n">sol</span><span class="p">[</span><span class="n">sol_key</span><span class="p">][</span><span class="s1">&#39;solution combination&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">num_profile_actions</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">mixed_index</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">max_prob_idx</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">chosen_profile</span> <span class="o">=</span> <span class="p">()</span>
            <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">included_palyers</span><span class="p">:</span>
                <span class="n">probs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">solution</span><span class="o">.</span><span class="n">sol</span><span class="p">[</span><span class="n">sol_key</span><span class="p">][</span><span class="s1">&#39;P&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">l</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39; action probs&#39;</span><span class="p">]</span>
                <span class="n">max_prob</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">probs</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">max_keys</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">probs</span><span class="p">))</span> <span class="k">if</span> <span class="n">probs</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">==</span> <span class="n">max_prob</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">max_keys</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">max_prob_idx</span><span class="p">[</span><span class="n">l</span><span class="p">]</span> <span class="o">=</span> <span class="n">max_keys</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">max_prob_idx</span><span class="p">[</span><span class="n">l</span><span class="p">]</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">max_keys</span><span class="p">)</span>
                <span class="n">chosen_profile</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">solution</span><span class="o">.</span><span class="n">sol</span><span class="p">[</span><span class="n">sol_key</span><span class="p">][</span><span class="s1">&#39;P&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">l</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39; action&#39;</span><span class="p">][</span><span class="n">max_prob_idx</span><span class="p">[</span><span class="n">l</span><span class="p">]]</span>
            <span class="n">mixed_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">solution</span><span class="o">.</span><span class="n">sol</span><span class="p">[</span><span class="n">sol_key</span><span class="p">][</span><span class="s1">&#39;solution combination&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">chosen_profile</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">chosen_equilibrium</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">solution</span><span class="o">.</span><span class="n">sol</span><span class="p">[</span><span class="n">sol_key</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">chosen_equilibrium</span><span class="p">[</span><span class="s1">&#39;chosen mixed profile action&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mixed_index</span>
        <span class="c1"># Compute complete results for the chosen equilibrium</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">chosen_equilibrium</span><span class="p">[</span><span class="s1">&#39;full result&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">ac</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chosen_equilibrium</span><span class="p">[</span><span class="s1">&#39;solution combination&#39;</span><span class="p">]):</span>
            <span class="k">if</span> <span class="n">preferred_players</span><span class="p">:</span>
                <span class="c1"># Rewrite the chosen equlibrium to be cmpatible with the basic normal game and players</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">chosen_equilibrium</span><span class="p">[</span><span class="s1">&#39;total cost&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">chosen_equilibrium</span><span class="p">[</span><span class="s1">&#39;total cost&#39;</span><span class="p">][</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">total_cost_dict</span><span class="p">[</span><span class="n">sol_key</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">chosen_equilibrium</span><span class="p">[</span><span class="s1">&#39;total cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">total_cost_dict</span><span class="p">[</span><span class="n">sol_key</span><span class="p">]</span>
                <span class="n">ac_old</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">ac</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;NA&#39;</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="n">included_palyers</span><span class="p">:</span>
                            <span class="n">ac_old</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="n">included_palyers</span><span class="p">:</span>
                        <span class="n">ac_old</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
                <span class="n">ac_old</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">ac_old</span><span class="p">)</span>
                <span class="n">ac</span> <span class="o">=</span> <span class="p">()</span>
                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">ac_old</span><span class="p">:</span>
                    <span class="n">new_a</span> <span class="o">=</span> <span class="p">()</span>
                    <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span><span class="s1">&#39;NA&#39;</span><span class="p">:</span>
                        <span class="n">new_a</span> <span class="o">+=</span> <span class="p">((</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">x</span><span class="p">:</span>
                            <span class="n">new_a</span> <span class="o">+=</span> <span class="p">((</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]),)</span>
                    <span class="n">ac</span> <span class="o">+=</span> <span class="p">(</span><span class="n">new_a</span><span class="p">,)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">chosen_equilibrium</span><span class="p">[</span><span class="s1">&#39;solution combination&#39;</span><span class="p">][</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">ac</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">chosen_equilibrium</span><span class="p">[</span><span class="s1">&#39;full result&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flow_problem</span><span class="p">(</span><span class="n">ac</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chosen_equilibrium</span><span class="p">[</span><span class="s1">&#39;full result&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">preferred_players</span><span class="p">:</span>
            <span class="n">original_tc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chosen_equilibrium</span><span class="p">[</span><span class="s1">&#39;total cost&#39;</span><span class="p">]</span>
            <span class="n">re_comp_tc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chosen_equilibrium</span><span class="p">[</span><span class="s1">&#39;full result&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;costs&#39;</span><span class="p">][</span><span class="s1">&#39;Total&#39;</span><span class="p">]</span>
            <span class="k">assert</span> <span class="nb">abs</span><span class="p">((</span><span class="n">re_comp_tc</span><span class="o">-</span><span class="n">original_tc</span><span class="p">)</span><span class="o">/</span><span class="n">original_tc</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.01</span><span class="p">,</span>\
            <span class="s1">&#39;Error: the re-computed total cost does not match the original one.&#39;</span></div>

<div class="viewcode-block" id="NormalGame.find_optimal_solution"><a class="viewcode-back" href="../gameclasses.html#gameclasses.NormalGame.find_optimal_solution">[docs]</a>    <span class="k">def</span> <span class="nf">find_optimal_solution</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Computes the centralized, optimal solution corresponding to</span>
<span class="sd">        the normal restoration game using INDP</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        :</span>
<span class="sd">            None.</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">v_r</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="n">x</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">v_r</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span>
        <span class="n">indp_res</span> <span class="o">=</span> <span class="n">indp</span><span class="o">.</span><span class="n">indp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">net</span><span class="p">,</span> <span class="n">v_r</span><span class="o">=</span><span class="n">v_r</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">layers</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="p">,</span>
                             <span class="n">controlled_layers</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="p">,</span> <span class="n">functionality</span><span class="o">=</span><span class="p">{},</span>
                             <span class="n">print_cmd</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">time_limit</span><span class="o">=</span><span class="kc">None</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">optimal_solution</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">l</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39; actions&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">()</span>
            <span class="k">for</span> <span class="n">act</span> <span class="ow">in</span> <span class="n">indp_res</span><span class="o">.</span><span class="n">results_layer</span><span class="p">[</span><span class="n">l</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;actions&#39;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="s1">&#39;/&#39;</span> <span class="ow">in</span> <span class="n">act</span><span class="p">:</span> 
                    <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;OA&#39;</span><span class="p">,</span><span class="n">l</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">optimal_solution</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">l</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39; actions&#39;</span><span class="p">]:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">optimal_solution</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">l</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39; actions&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="p">((</span><span class="s1">&#39;OA&#39;</span><span class="p">,</span> <span class="n">l</span><span class="p">),)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">act</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">act</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)]</span>
                    <span class="k">if</span> <span class="p">((</span><span class="n">act</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">act</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dependee_nodes</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">optimal_solution</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">l</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39; actions&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="p">((</span><span class="n">act</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">act</span><span class="p">[</span><span class="mi">1</span><span class="p">]),)</span>
                    <span class="k">elif</span> <span class="p">(</span><span class="s1">&#39;OA&#39;</span><span class="p">,</span><span class="n">l</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">optimal_solution</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">l</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39; actions&#39;</span><span class="p">]:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">optimal_solution</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">l</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39; actions&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="p">((</span><span class="s1">&#39;OA&#39;</span><span class="p">,</span> <span class="n">l</span><span class="p">),)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">indp_res</span><span class="o">.</span><span class="n">results_layer</span><span class="p">[</span><span class="n">l</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;actions&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">optimal_solution</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">l</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39; actions&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="p">(</span><span class="s1">&#39;NA&#39;</span><span class="p">,</span> <span class="n">l</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">optimal_solution</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">l</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39; payoff&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">indp_res</span><span class="o">.</span><span class="n">results_layer</span><span class="p">[</span><span class="n">l</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;costs&#39;</span><span class="p">][</span><span class="s1">&#39;Total&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">optimal_solution</span><span class="p">[</span><span class="s1">&#39;total cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">indp_res</span><span class="o">.</span><span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;costs&#39;</span><span class="p">][</span><span class="s1">&#39;Total&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">optimal_solution</span><span class="p">[</span><span class="s1">&#39;full result&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">indp_res</span></div></div>

<div class="viewcode-block" id="BayesianGame"><a class="viewcode-back" href="../gameclasses.html#gameclasses.BayesianGame">[docs]</a><span class="k">class</span> <span class="nc">BayesianGame</span><span class="p">(</span><span class="n">NormalGame</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    This class models a Bayesian restoration game for a given time step </span>
<span class="sd">    and finds bayes nash equilibria. This class inherits from :class:`NormalGame`.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    fundamental_types : list</span>
<span class="sd">        List of fundamental types of players. Currently, it consists of two types:</span>

<span class="sd">        - Cooperative(C) player, which prefers cooperative and partially cooperative actions.</span>
<span class="sd">        - Non-cooperative (N) player, which prefers non-cooperative actions.</span>
<span class="sd">    states : dict</span>
<span class="sd">        List of state(s) of the game.</span>
<span class="sd">    states_payoffs : dict</span>
<span class="sd">        List of payoff matrices of state(s) of the game.</span>
<span class="sd">    types : dict</span>
<span class="sd">        List of players&#39; type(s).</span>
<span class="sd">    bayesian_players : list</span>
<span class="sd">        List of bayesian players of the game comprising combiantion of players </span>
<span class="sd">        and their types.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">net</span><span class="p">,</span> <span class="n">v_r</span><span class="p">,</span> <span class="n">act_rduc</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">L</span><span class="p">,</span> <span class="n">net</span><span class="p">,</span> <span class="n">v_r</span><span class="p">,</span> <span class="n">act_rduc</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fundamental_types</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="s1">&#39;N&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">states</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">states_payoffs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">types</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bayesian_players</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bayesian_payoffs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bayesian_game</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">__getstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return state values to be pickled. Gambit game object is deleted when</span>
<span class="sd">        pickling. To retirve it, user should save the game to file when building </span>
<span class="sd">        the game and read it later and add it to to the unpickled object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">state</span><span class="p">[</span><span class="s2">&quot;normgame&quot;</span><span class="p">]</span> <span class="o">=</span>  <span class="p">{}</span>
        <span class="n">state</span><span class="p">[</span><span class="s2">&quot;bayesian_game&quot;</span><span class="p">]</span> <span class="o">=</span>  <span class="p">{}</span>
        <span class="k">return</span> <span class="n">state</span>

<div class="viewcode-block" id="BayesianGame.label_actions"><a class="viewcode-back" href="../gameclasses.html#gameclasses.BayesianGame.label_actions">[docs]</a>    <span class="k">def</span> <span class="nf">label_actions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">action</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        This function return the type of an input action in accordance with</span>
<span class="sd">        :attr:`fundamental_types`:</span>

<span class="sd">            - &#39;C&#39; (cooperative) action consists of one or several actions that</span>
<span class="sd">              some of them are relevent---i.e., reparing damaged nodes that on which</span>
<span class="sd">              other players depend. A &#39;C&#39; action may include &#39;OA&#39; action as well,</span>
<span class="sd">              but it cannot be only one &#39;OA&#39; action. </span>
<span class="sd">            - &#39;N&#39; (non-cooperative) action is either &#39;NA&#39; or &#39;OA&#39;.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        action : tuple</span>
<span class="sd">            An action.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        label : str</span>
<span class="sd">            The action type.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">label</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">action</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">action</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;OA&#39;</span><span class="p">:</span>
            <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;N&#39;</span>
        <span class="k">elif</span> <span class="n">action</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;NA&#39;</span><span class="p">:</span>
            <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;N&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;C&#39;</span>
            <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">action</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;OA&#39;</span><span class="p">:</span>
                    <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;C&#39;</span> <span class="c1">#&#39;P&#39;</span>
                    <span class="k">break</span>
        <span class="k">return</span> <span class="n">label</span></div>

<div class="viewcode-block" id="BayesianGame.set_states"><a class="viewcode-back" href="../gameclasses.html#gameclasses.BayesianGame.set_states">[docs]</a>    <span class="k">def</span> <span class="nf">set_states</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        This function set the states based on :attr:`fundamental_types` and for</span>
<span class="sd">        each state compute the payoff matrix of all players by doubling the payoff</span>
<span class="sd">        of actions that are not consistant with the player&#39;s type.</span>

<span class="sd">        .. todo::</span>
<span class="sd">            Games: refine how to reduce importance of other types</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">comb_w_rep</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">combinations</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fundamental_types</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="p">),</span>
                                                 <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">states</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">comb_w_rep</span><span class="p">))</span>
        <span class="c1"># Assign payoff matrix for each state</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">states_payoffs</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">payoffs</span><span class="p">)</span> <span class="c1">#!!!deepcopy</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">states_payoffs</span><span class="p">[</span><span class="n">s</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="p">):</span>
                    <span class="n">label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_actions</span><span class="p">(</span><span class="n">val</span><span class="p">[</span><span class="n">l</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
                    <span class="k">if</span> <span class="n">label</span> <span class="o">!=</span> <span class="n">s</span><span class="p">[</span><span class="n">idx</span><span class="p">]:</span>
                        <span class="n">val</span><span class="p">[</span><span class="n">l</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">*=</span> <span class="mi">2</span> <span class="c1">#!!!</span></div>

<div class="viewcode-block" id="BayesianGame.set_types"><a class="viewcode-back" href="../gameclasses.html#gameclasses.BayesianGame.set_types">[docs]</a>    <span class="k">def</span> <span class="nf">set_types</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">beliefs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        This function set players type based on the beliefs it receives. Currently,</span>
<span class="sd">        it can interpret the follwoing signnals:</span>

<span class="sd">            - Uninformed (&#39;U&#39;): Players  do not have any information about other players,</span>
<span class="sd">              and assign equal probability to other players&#39; types.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        beliefs : dict</span>
<span class="sd">            The collection of beliefs for all players .</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="p">)</span>
        <span class="n">T</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fundamental_types</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">types</span><span class="p">[</span><span class="n">l</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">x</span><span class="p">:{}</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fundamental_types</span><span class="p">}</span>
            <span class="k">if</span> <span class="n">beliefs</span><span class="p">[</span><span class="n">l</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;U&quot;</span><span class="p">:</span> <span class="c1">#Uninformed</span>
                <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fundamental_types</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">s</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">==</span><span class="n">t</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">types</span><span class="p">[</span><span class="n">l</span><span class="p">][</span><span class="n">t</span><span class="p">][</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">T</span><span class="o">/</span><span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">types</span><span class="p">[</span><span class="n">l</span><span class="p">][</span><span class="n">t</span><span class="p">][</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">elif</span> <span class="n">beliefs</span><span class="p">[</span><span class="n">l</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;F&quot;</span><span class="p">:</span> <span class="c1">#false consensus effect or consensus bias</span>
                <span class="n">P</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="n">N</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span>
                <span class="n">prob_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">n</span><span class="p">:[</span><span class="n">scipy</span><span class="o">.</span><span class="n">special</span><span class="o">.</span><span class="n">comb</span><span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">N</span><span class="o">-</span><span class="n">n</span><span class="p">,</span> <span class="n">exact</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">T</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="n">n</span><span class="p">),</span>
                                <span class="n">P</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="n">n</span><span class="p">))]</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">)}</span>
                <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fundamental_types</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">s</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">==</span><span class="n">t</span><span class="p">:</span>
                            <span class="n">num_agree</span> <span class="o">=</span> <span class="nb">len</span><span class="p">([</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">s</span> <span class="k">if</span> <span class="n">x</span><span class="o">==</span><span class="n">t</span><span class="p">])</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">types</span><span class="p">[</span><span class="n">l</span><span class="p">][</span><span class="n">t</span><span class="p">][</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="n">prob_dict</span><span class="p">[</span><span class="n">num_agree</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">prob_dict</span><span class="p">[</span><span class="n">num_agree</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">types</span><span class="p">[</span><span class="n">l</span><span class="p">][</span><span class="n">t</span><span class="p">][</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">elif</span> <span class="n">beliefs</span><span class="p">[</span><span class="n">l</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;I&quot;</span><span class="p">:</span> <span class="c1"># Inverse false consensus effect </span>
                <span class="n">P</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="n">N</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span>
                <span class="n">prob_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">n</span><span class="p">:[</span><span class="n">scipy</span><span class="o">.</span><span class="n">special</span><span class="o">.</span><span class="n">comb</span><span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">N</span><span class="o">-</span><span class="n">n</span><span class="p">,</span> <span class="n">exact</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">T</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="n">n</span><span class="p">),</span>
                                <span class="n">P</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">))]</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">)}</span>
                <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fundamental_types</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">s</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">==</span><span class="n">t</span><span class="p">:</span>
                            <span class="n">num_agree</span> <span class="o">=</span> <span class="nb">len</span><span class="p">([</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">s</span> <span class="k">if</span> <span class="n">x</span><span class="o">==</span><span class="n">t</span><span class="p">])</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">types</span><span class="p">[</span><span class="n">l</span><span class="p">][</span><span class="n">t</span><span class="p">][</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="n">prob_dict</span><span class="p">[</span><span class="n">num_agree</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">prob_dict</span><span class="p">[</span><span class="n">num_agree</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">types</span><span class="p">[</span><span class="n">l</span><span class="p">][</span><span class="n">t</span><span class="p">][</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s1">&#39;Error: wrong signal name&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="BayesianGame.create_bayesian_players"><a class="viewcode-back" href="../gameclasses.html#gameclasses.BayesianGame.create_bayesian_players">[docs]</a>    <span class="k">def</span> <span class="nf">create_bayesian_players</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        This function create one player for each combination of player and its types.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">for</span> <span class="n">lyr</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">typ</span><span class="p">,</span> <span class="n">valtyp</span> <span class="ow">in</span> <span class="n">val</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">bayesian_players</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">typ</span><span class="p">,</span> <span class="n">lyr</span><span class="p">))</span></div>

    <span class="k">def</span> <span class="nf">compute_bayesian_payoffs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">bayes_actions</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">actions_super_set</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bayesian_players</span><span class="p">:</span>
            <span class="n">actions_super_set</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
            <span class="n">actions_super_set</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">actions</span><span class="p">[</span><span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
        <span class="n">action_comb</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="o">*</span><span class="n">actions_super_set</span><span class="p">))</span>
        <span class="c1"># compute payoffs for each possible combinations of actions</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">ac</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">action_comb</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bayesian_payoffs</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">idxb</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bayesian_players</span><span class="p">):</span>
                <span class="n">payoff</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="p">:</span>
                    <span class="n">prob_state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">types</span><span class="p">[</span><span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="n">s</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">prob_state</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                        <span class="n">payoff_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">states_payoffs</span><span class="p">[</span><span class="n">s</span><span class="p">]</span>
                        <span class="n">payoff_keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">payoff_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
                        <span class="k">for</span> <span class="n">idxl</span><span class="p">,</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="p">):</span>
                            <span class="n">temp</span> <span class="o">=</span> <span class="p">[]</span>
                            <span class="n">player_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bayesian_players</span><span class="o">.</span><span class="n">index</span><span class="p">((</span><span class="n">s</span><span class="p">[</span><span class="n">idxl</span><span class="p">],</span> <span class="n">l</span><span class="p">))</span>
                            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">payoff_keys</span><span class="p">:</span>
                                <span class="k">if</span> <span class="n">payoff_dict</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">l</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">ac</span><span class="p">[</span><span class="n">player_index</span><span class="p">]:</span>
                                    <span class="n">temp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
                            <span class="n">payoff_keys</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">temp</span><span class="p">]</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">payoff_keys</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
                            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s1">&#39;Error: cannot find the payoff value for&#39;</span><span class="p">,</span> <span class="n">ac</span><span class="p">)</span>
                        <span class="n">utility_val</span> <span class="o">=</span> <span class="n">payoff_dict</span><span class="p">[</span><span class="n">payoff_keys</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="mi">1</span><span class="p">]</span>
                        <span class="n">payoff</span> <span class="o">+=</span> <span class="n">prob_state</span><span class="o">*</span><span class="n">utility_val</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">bayesian_payoffs</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="n">b</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">ac</span><span class="p">[</span><span class="n">idxb</span><span class="p">],</span> <span class="n">payoff</span><span class="p">]</span>

<div class="viewcode-block" id="BayesianGame.build_bayesian_game"><a class="viewcode-back" href="../gameclasses.html#gameclasses.BayesianGame.build_bayesian_game">[docs]</a>    <span class="k">def</span> <span class="nf">build_bayesian_game</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">save_model</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        This function constructs the bayesian restoratuion game</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        save_model : str, optional</span>
<span class="sd">            Directory to which the game should be written as a .txt file. The default</span>
<span class="sd">            is None, which prevents writing to file.</span>
<span class="sd">        suffix : str, optional</span>
<span class="sd">            An optional suffix thta is added to the file name. The default is &#39;&#39;.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        :</span>
<span class="sd">            None.</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">dimensions</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bayesian_players</span><span class="p">:</span>
            <span class="n">dimensions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">actions</span><span class="p">[</span><span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">]]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bayesian_game</span> <span class="o">=</span> <span class="n">gambit</span><span class="o">.</span><span class="n">Game</span><span class="o">.</span><span class="n">new_table</span><span class="p">(</span><span class="n">dimensions</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">idxl</span><span class="p">,</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bayesian_players</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">idxal</span><span class="p">,</span> <span class="n">al</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">actions</span><span class="p">[</span><span class="n">l</span><span class="p">[</span><span class="mi">1</span><span class="p">]]):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">bayesian_game</span><span class="o">.</span><span class="n">players</span><span class="p">[</span><span class="n">idxl</span><span class="p">]</span><span class="o">.</span><span class="n">strategies</span><span class="p">[</span><span class="n">idxal</span><span class="p">]</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">al</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">ac</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bayesian_payoffs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">payoff_cell_corrdinate</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">keyl</span><span class="p">,</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">ac</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">payoff_cell_corrdinate</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
            <span class="k">for</span> <span class="n">keyl</span><span class="p">,</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">ac</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bayesian_players</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">keyl</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">bayesian_game</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">payoff_cell_corrdinate</span><span class="p">)][</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">fractions</span><span class="o">.</span><span class="n">Fraction</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">save_model</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">save_model</span><span class="p">):</span>
                <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">save_model</span><span class="p">)</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">save_model</span><span class="o">+</span><span class="s1">&#39;/bayes_game_&#39;</span><span class="o">+</span><span class="n">suffix</span><span class="o">+</span><span class="s2">&quot;.txt&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">text_file</span><span class="p">:</span>
                <span class="n">text_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bayesian_game</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">format</span><span class="o">=</span><span class="s1">&#39;native&#39;</span><span class="p">)[</span><span class="mi">2</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">n&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">))</span></div></div>

<div class="viewcode-block" id="GameSolution"><a class="viewcode-back" href="../gameclasses.html#gameclasses.GameSolution">[docs]</a><span class="k">class</span> <span class="nc">GameSolution</span><span class="p">:</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    This class extracts (from the gambit solution) and saves the solution of the normal game</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    players : list</span>
<span class="sd">        List of players, set based on &#39;L&#39; from input variables of :class:`GameSolution`</span>
<span class="sd">    gambit_sol : list</span>
<span class="sd">        Solutions to the game computed by gambit, set based on &#39;sol&#39; from input variables</span>
<span class="sd">        of :class:`GameSolution`</span>
<span class="sd">    sol : dict</span>
<span class="sd">        Dictionary of solutions of the normal game, including actions, their probabilities,</span>
<span class="sd">        payoffs, and the total cost,  set by :meth:`extract_solution`.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">sol</span><span class="p">,</span> <span class="n">actions</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">players</span> <span class="o">=</span> <span class="n">L</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gambit_sol</span> <span class="o">=</span> <span class="n">sol</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sol</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extract_solution</span><span class="p">(</span><span class="n">actions</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__getstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return state values to be pickled. gambit_sol is deleted when</span>
<span class="sd">        pickling. To retirve it, user should save the game to file when building </span>
<span class="sd">        the game and read it later and add it to to the unpickled object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">state</span><span class="p">[</span><span class="s2">&quot;gambit_sol&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">return</span> <span class="n">state</span>

    <span class="k">def</span> <span class="nf">__setstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Restore state from the unpickled state values. gambit_sol is deleted when</span>
<span class="sd">        pickling. To retirve it, user should save the game to file when building </span>
<span class="sd">        the game and read it later and add it to to the unpickled object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
        <span class="n">state</span><span class="p">[</span><span class="s2">&quot;gambit_sol&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        
<div class="viewcode-block" id="GameSolution.extract_solution"><a class="viewcode-back" href="../gameclasses.html#gameclasses.GameSolution.extract_solution">[docs]</a>    <span class="k">def</span> <span class="nf">extract_solution</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">actions</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        This function extracts the solution of the normal game from the solution</span>
<span class="sd">        structure from gambit</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        actions : dict</span>
<span class="sd">            Possible actions for each palyer.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        sol : dict</span>
<span class="sd">            Dictionary of solutions of the normal game, including actions, their probabilities,</span>
<span class="sd">            payoffs, and the total cost.</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">sup_action</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">sol</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="p">:</span>
            <span class="n">sup_action</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">actions</span><span class="p">[</span><span class="n">l</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gambit_sol</span><span class="p">):</span>
            <span class="n">sol</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="p">:</span>
                <span class="n">sol</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="s1">&#39;P&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">l</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39; actions&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">sol</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="s1">&#39;P&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">l</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39; action probs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">c</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
            <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">x</span><span class="p">:</span>
                <span class="n">c</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">y</span> <span class="o">&gt;</span> <span class="mf">1e-3</span><span class="p">:</span>
                    <span class="n">act</span> <span class="o">=</span> <span class="n">sup_action</span><span class="p">[</span><span class="n">c</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">act</span> <span class="ow">in</span> <span class="n">actions</span><span class="p">[</span><span class="n">l</span><span class="p">]:</span>
                            <span class="n">plyr</span> <span class="o">=</span> <span class="n">l</span>
                    <span class="n">sol</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="s1">&#39;P&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">plyr</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39; actions&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">act</span><span class="p">)</span>
                    <span class="n">sol</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="s1">&#39;P&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">plyr</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39; action probs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>
            <span class="n">total_cost</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">idxl</span><span class="p">,</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">players</span><span class="p">):</span>
                <span class="n">sol</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="s1">&#39;P&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">l</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39; payoff&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">payoff</span><span class="p">()[</span><span class="n">idxl</span><span class="p">])</span>
                <span class="n">total_cost</span> <span class="o">-=</span> <span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">payoff</span><span class="p">()[</span><span class="n">idxl</span><span class="p">])</span>
            <span class="n">sol</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="s1">&#39;total cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">total_cost</span>
        <span class="k">return</span> <span class="n">sol</span></div></div>

<div class="viewcode-block" id="InfrastructureGame"><a class="viewcode-back" href="../gameclasses.html#gameclasses.InfrastructureGame">[docs]</a><span class="k">class</span> <span class="nc">InfrastructureGame</span><span class="p">:</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    This class is employed to find the restoration strategy for an interdepndent network</span>
<span class="sd">    using game theoretic methods over a given time horizon</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    layers : list</span>
<span class="sd">        List of layers (= players), set based on [&#39;L&#39;] in :class:`params &lt;InfrastructureGame&gt;`</span>
<span class="sd">    game_type : str</span>
<span class="sd">        Type of the game, set based on [&#39;ALGORITHM&#39;] in :class:`params &lt;InfrastructureGame&gt;` \n</span>
<span class="sd">            Options: NORMALGAME</span>
<span class="sd">    equib_alg : str</span>
<span class="sd">        Algorithm to solve the game, set based on [&#39;EQUIBALG&#39;] in :class:`params &lt;InfrastructureGame&gt;` \n</span>
<span class="sd">            Options: enumpure_solve, enummixed_solve, lcp_solve, lp_solve, simpdiv_solve,</span>
<span class="sd">            ipa_solve, gnm_solve</span>
<span class="sd">    magnitude : int</span>
<span class="sd">        Magnitude parameter of the current simulation, set based on [&#39;MAGNITUDE&#39;] in</span>
<span class="sd">        :class:`params &lt;InfrastructureGame&gt;`</span>
<span class="sd">    sample : int</span>
<span class="sd">        Sample parameter of the current simulation, set based on [&#39;SIM_NUMBER&#39;] in</span>
<span class="sd">        :class:`params &lt;InfrastructureGame&gt;`</span>
<span class="sd">    net : :class:`~infrastructure.InfrastructureNetwork`</span>
<span class="sd">        Object that stores network information, set based on :class:`params &lt;InfrastructureGame&gt;`</span>
<span class="sd">        using :meth:`set_network`</span>
<span class="sd">    time_steps : int</span>
<span class="sd">        Number of time steps pf the restoration process, set based on</span>
<span class="sd">        :class:`params &lt;InfrastructureGame&gt;` using :meth:`set_time_steps`</span>
<span class="sd">    objs : dict of :class:`NormalGame`</span>
<span class="sd">        Dictionary of game objects (:class:`NormalGame`) for all time steps of the restoration</span>
<span class="sd">    judgments : :class:`~dindpclasses.JudgmentModel`</span>
<span class="sd">        Object that stores the judgment attitude of agents, which is only needed </span>
<span class="sd">        for computing the resource allocation when using auction. So, it is not</span>
<span class="sd">        used in building or solving the games</span>
<span class="sd">    results : :class:`~indputils.INDPResults`</span>
<span class="sd">        Object that stores the restoration strategies for all time steps of the</span>
<span class="sd">        restoration process</span>
<span class="sd">    resource : :class:`~dindpclasses.ResourceModel`</span>
<span class="sd">        Model that allocates resources and stores the resource allocation data for</span>
<span class="sd">        all time steps of the restoration process</span>
<span class="sd">    res_alloc_type : str</span>
<span class="sd">        Resource allocation method</span>
<span class="sd">    v_r : dict</span>
<span class="sd">        Dictionary that stores the number of available resources, :math:`R_c`, for</span>
<span class="sd">        all time steps of the restoration process</span>
<span class="sd">    output_dir : str</span>
<span class="sd">        Directory to which the results are written, set by :meth:`set_out_dir`</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layers</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">game_type</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;ALGORITHM&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">beliefs</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;BELIEFS&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">signals</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;SIGNALS&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">equib_alg</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;EQUIBALG&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">magnitude</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;MAGNITUDE&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sample</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;SIM_NUMBER&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actions_reduced</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;REDUCED_ACTIONS&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">net</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_network</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time_steps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_time_steps</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">],</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;NUM_ITERATIONS&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">objs</span> <span class="o">=</span> <span class="p">{</span><span class="n">t</span><span class="p">:</span><span class="mi">0</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">time_steps</span><span class="o">+</span><span class="mi">1</span><span class="p">)}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">judgments</span> <span class="o">=</span> <span class="n">dindpclasses</span><span class="o">.</span><span class="n">JudgmentModel</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_steps</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">results</span> <span class="o">=</span> <span class="n">indputils</span><span class="o">.</span><span class="n">INDPResults</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resource</span> <span class="o">=</span> <span class="n">dindpclasses</span><span class="o">.</span><span class="n">ResourceModel</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_steps</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">res_alloc_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="o">.</span><span class="n">type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">v_r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="o">.</span><span class="n">v_r</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_out_dir</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;OUTPUT_DIR&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">payoff_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_payoff_dir</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;PAYOFF_DIR&#39;</span><span class="p">])</span>

<div class="viewcode-block" id="InfrastructureGame.run_game"><a class="viewcode-back" href="../gameclasses.html#gameclasses.InfrastructureGame.run_game">[docs]</a>    <span class="k">def</span> <span class="nf">run_game</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">print_cmd</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">compute_optimal</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">save_results</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                 <span class="n">plot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">save_model</span><span class="o">=</span><span class="kc">False</span><span class="p">,):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Runs the infrastructure restoarion game for a given number of :attr:`time_steps`</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        print_cmd : bool, optional</span>
<span class="sd">            Should the game solution be printed to the command line. The default is True.</span>
<span class="sd">        compute_optimal : bool, optional</span>
<span class="sd">            Should the optimal restoarion action be found in each time step. The default is False.</span>
<span class="sd">        save_results : bool, optional</span>
<span class="sd">            Should the results and game be written to file. The default is True.</span>
<span class="sd">        plot : bool, optional</span>
<span class="sd">            Should the payoff matrix be plotted (only for 2-players games). The default is False.</span>
<span class="sd">        save_model : bool, optional</span>
<span class="sd">            Should the games and indp models to compute payoffs be written to file. The default is False.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        :</span>
<span class="sd">            None</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">save_model_dir</span> <span class="o">=</span> <span class="n">save_model</span>
        <span class="n">save_payoff_info</span> <span class="o">=</span> <span class="n">save_model</span>
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">objs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-Time Step&quot;</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_steps</span><span class="p">)</span>
            <span class="c1">#: Resource Allocation</span>
            <span class="n">res_alloc_time_start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">&#39;AUCTION&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="o">.</span><span class="n">auction_model</span><span class="o">.</span><span class="n">auction_resources</span><span class="p">(</span><span class="n">obj</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
                                                              <span class="n">time_step</span><span class="o">=</span><span class="n">t</span><span class="p">,</span>
                                                              <span class="n">print_cmd</span><span class="o">=</span><span class="n">print_cmd</span><span class="p">,</span>
                                                              <span class="n">compute_poa</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="o">.</span><span class="n">time</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="o">-</span><span class="n">res_alloc_time_start</span>
            <span class="c1"># Create game object</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">game_type</span> <span class="o">==</span> <span class="s1">&#39;NORMALGAME&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">objs</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">NormalGame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">net</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">v_r</span><span class="p">[</span><span class="n">t</span><span class="p">],</span> 
                                          <span class="n">act_rduc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">actions_reduced</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">game_type</span> <span class="o">==</span> <span class="s1">&#39;BAYESGAME&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">objs</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">BayesianGame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">net</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">v_r</span><span class="p">[</span><span class="n">t</span><span class="p">],</span> 
                                          <span class="n">act_rduc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">actions_reduced</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s1">&#39;Error: wrong algorithm name for Infrastructure Game.&#39;</span><span class="p">)</span>
            <span class="c1"># Compute payoffs</span>
            <span class="k">if</span> <span class="n">print_cmd</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Computing payoffs...&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">save_payoff_info</span><span class="p">:</span>
                <span class="n">save_payoff_info</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">output_dir</span><span class="o">+</span><span class="s1">&#39;/payoff_models&#39;</span><span class="p">,</span> <span class="n">t</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">objs</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">.</span><span class="n">first_actions</span><span class="p">)</span> <span class="o">==</span> <span class="p">{</span><span class="s1">&#39;NA&#39;</span><span class="p">}:</span>
                <span class="k">pass</span>
            <span class="k">elif</span> <span class="n">t</span><span class="o">==</span><span class="mi">1</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">payoff_dir</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">print_cmd</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Reading payoffs...&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">objs</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">.</span><span class="n">compute_payoffs</span><span class="p">(</span><span class="n">save_model</span><span class="o">=</span><span class="n">save_payoff_info</span><span class="p">,</span>
                                             <span class="n">payoff_dir</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">payoff_dir</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">v_r</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">objs</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">.</span><span class="n">v_r</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="o">.</span><span class="n">type</span> <span class="o">!=</span> <span class="s1">&#39;UNIFORM&#39;</span><span class="p">:</span>
                        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s1">&#39;Error: read obj changes v_r invalidly&#39;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">v_r</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">objs</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">.</span><span class="n">v_r</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="o">.</span><span class="n">v_r</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">objs</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">.</span><span class="n">v_r</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">objs</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">.</span><span class="n">compute_payoffs</span><span class="p">(</span><span class="n">save_model</span><span class="o">=</span><span class="n">save_payoff_info</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">save_results</span><span class="p">:</span> <span class="c1">#!!! removewhen don&#39;t need to save after payoff</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">save_object_to_file</span><span class="p">()</span>
            <span class="c1"># Solve game</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">objs</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">.</span><span class="n">payoffs</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">print_cmd</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Building and Solving the game...&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">compute_optimal</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">objs</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">.</span><span class="n">find_optimal_solution</span><span class="p">()</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">game_type</span> <span class="o">==</span> <span class="s1">&#39;NORMALGAME&#39;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">save_model_dir</span><span class="p">:</span>
                        <span class="n">save_model_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_dir</span><span class="o">+</span><span class="s1">&#39;/games&#39;</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">objs</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">.</span><span class="n">build_game</span><span class="p">(</span><span class="n">save_model</span><span class="o">=</span><span class="n">save_model_dir</span><span class="p">,</span>
                                            <span class="n">suffix</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sample</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;_t&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>
                    <span class="n">game_start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">objs</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">.</span><span class="n">solve_game</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">equib_alg</span><span class="p">,</span> <span class="n">print_to_cmd</span><span class="o">=</span><span class="n">print_cmd</span><span class="p">)</span>
                    <span class="n">game_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="o">-</span><span class="n">game_start</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">objs</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">.</span><span class="n">choose_equilibrium</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">plot</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="p">)</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_dir</span><span class="o">+</span><span class="s1">&#39;/payoff_matrix&#39;</span><span class="p">):</span>
                            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_dir</span><span class="o">+</span><span class="s1">&#39;/payoff_matrix&#39;</span><span class="p">)</span>
                        <span class="n">plots</span><span class="o">.</span><span class="n">plot_ne_sol_2player</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">objs</span><span class="p">[</span><span class="n">t</span><span class="p">],</span> <span class="n">suffix</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sample</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;_t&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">),</span>
                                                  <span class="n">plot_dir</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">output_dir</span><span class="o">+</span><span class="s1">&#39;/payoff_matrix&#39;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">game_type</span> <span class="o">==</span> <span class="s1">&#39;BAYESGAME&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">objs</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">.</span><span class="n">set_states</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">objs</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">.</span><span class="n">set_types</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">beliefs</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">objs</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">.</span><span class="n">create_bayesian_players</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">objs</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">.</span><span class="n">compute_bayesian_payoffs</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">save_model</span><span class="p">:</span>
                        <span class="n">save_model_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_dir</span><span class="o">+</span><span class="s1">&#39;/bayesian_games&#39;</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">objs</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">.</span><span class="n">build_bayesian_game</span><span class="p">(</span><span class="n">save_model</span><span class="o">=</span><span class="n">save_model_dir</span><span class="p">,</span>
                                                     <span class="n">suffix</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sample</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;_t&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>
                    <span class="c1">### Game info needed to pass to the solver</span>
                    <span class="n">game_info</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">objs</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">.</span><span class="n">bayesian_game</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">objs</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">.</span><span class="n">bayesian_players</span><span class="p">]</span>
                    <span class="n">action_list</span> <span class="o">=</span> <span class="p">{}</span>
                    <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">objs</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">.</span><span class="n">bayesian_players</span><span class="p">:</span>
                        <span class="n">action_list</span><span class="p">[</span><span class="n">b</span><span class="p">]</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">objs</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">.</span><span class="n">actions</span><span class="p">[</span><span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
                        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">ac</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">action_list</span><span class="p">[</span><span class="n">b</span><span class="p">]):</span>
                            <span class="k">if</span> <span class="n">ac</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;NA&#39;</span><span class="p">:</span>
                                <span class="n">action_list</span><span class="p">[</span><span class="n">b</span><span class="p">][</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">ac</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">b</span><span class="p">)</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">temp</span> <span class="o">=</span> <span class="p">()</span>
                                <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">ac</span><span class="p">:</span>
                                    <span class="n">temp</span> <span class="o">+=</span> <span class="p">((</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">b</span><span class="p">),)</span>
                                <span class="n">action_list</span><span class="p">[</span><span class="n">b</span><span class="p">][</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">temp</span>
                    <span class="n">game_info</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">action_list</span><span class="p">)</span>
                    <span class="n">game_start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">objs</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">.</span><span class="n">solve_game</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">equib_alg</span><span class="p">,</span> <span class="n">print_to_cmd</span><span class="o">=</span><span class="n">print_cmd</span><span class="p">,</span>
                                            <span class="n">game_info</span><span class="o">=</span><span class="n">game_info</span><span class="p">)</span>
                    <span class="n">game_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="o">-</span><span class="n">game_start</span>
                    <span class="c1">### Use signals to find interim NE as the chosen solution</span>
                    <span class="n">preferred_players</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;included&#39;</span><span class="p">:</span> <span class="p">[(</span><span class="n">x</span><span class="p">,</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">signals</span><span class="o">.</span><span class="n">items</span><span class="p">()]}</span>
                    <span class="n">preferred_players</span><span class="p">[</span><span class="s1">&#39;excluded&#39;</span><span class="p">]</span> <span class="o">=</span>  <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">objs</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">.</span><span class="n">bayesian_players</span>\
                                                      <span class="k">if</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">preferred_players</span><span class="p">[</span><span class="s1">&#39;included&#39;</span><span class="p">]]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">objs</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">.</span><span class="n">choose_equilibrium</span><span class="p">(</span><span class="n">preferred_players</span><span class="o">=</span><span class="n">preferred_players</span><span class="p">)</span>

                <span class="n">mixed_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">objs</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">.</span><span class="n">chosen_equilibrium</span><span class="p">[</span><span class="s1">&#39;chosen mixed profile action&#39;</span><span class="p">]</span>
                <span class="n">ne_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">objs</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">.</span><span class="n">chosen_equilibrium</span><span class="p">[</span><span class="s1">&#39;full result&#39;</span><span class="p">][</span><span class="n">mixed_index</span><span class="p">]</span>
                <span class="n">ne_results</span><span class="o">.</span><span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;run_time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">game_time</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">ne_results</span><span class="p">,</span> <span class="n">t_offset</span><span class="o">=</span><span class="n">t</span><span class="p">)</span>
                <span class="n">indp</span><span class="o">.</span><span class="n">apply_recovery</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">net</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;No further action for any of players&#39;</span><span class="p">)</span>
                <span class="n">ne_results</span> <span class="o">=</span> <span class="n">indputils</span><span class="o">.</span><span class="n">INDPResults</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="p">)</span>
                <span class="n">ne_results</span><span class="o">.</span><span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="p">[</span><span class="n">t</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="c1">#!!!deepcopy</span>
                <span class="n">costs</span> <span class="o">=</span> <span class="n">ne_results</span><span class="o">.</span><span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;costs&#39;</span><span class="p">]</span>
                <span class="n">costs</span><span class="p">[</span><span class="s1">&#39;Total&#39;</span><span class="p">]</span> <span class="o">-=</span> <span class="n">costs</span><span class="p">[</span><span class="s1">&#39;Arc&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">costs</span><span class="p">[</span><span class="s1">&#39;Node&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">costs</span><span class="p">[</span><span class="s1">&#39;Space Prep&#39;</span><span class="p">]</span>
                <span class="n">costs</span><span class="p">[</span><span class="s1">&#39;Total no disconnection&#39;</span><span class="p">]</span> <span class="o">-=</span> <span class="n">costs</span><span class="p">[</span><span class="s1">&#39;Arc&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">costs</span><span class="p">[</span><span class="s1">&#39;Node&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">costs</span><span class="p">[</span><span class="s1">&#39;Space Prep&#39;</span><span class="p">]</span>
                <span class="n">costs</span><span class="p">[</span><span class="s1">&#39;Arc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="n">costs</span><span class="p">[</span><span class="s1">&#39;Node&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="n">costs</span><span class="p">[</span><span class="s1">&#39;Space Prep&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="n">ne_results</span><span class="o">.</span><span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;actions&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">ne_results</span><span class="o">.</span><span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;run_time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="p">:</span>
                    <span class="n">ne_results</span><span class="o">.</span><span class="n">results_layer</span><span class="p">[</span><span class="n">l</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="o">.</span><span class="n">results_layer</span><span class="p">[</span><span class="n">l</span><span class="p">][</span><span class="n">t</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="c1">#!!!deepcopy</span>
                    <span class="n">costs</span> <span class="o">=</span> <span class="n">ne_results</span><span class="o">.</span><span class="n">results_layer</span><span class="p">[</span><span class="n">l</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;costs&#39;</span><span class="p">]</span>
                    <span class="n">costs</span><span class="p">[</span><span class="s1">&#39;Total&#39;</span><span class="p">]</span> <span class="o">-=</span> <span class="n">costs</span><span class="p">[</span><span class="s1">&#39;Arc&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">costs</span><span class="p">[</span><span class="s1">&#39;Node&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">costs</span><span class="p">[</span><span class="s1">&#39;Space Prep&#39;</span><span class="p">]</span>
                    <span class="n">costs</span><span class="p">[</span><span class="s1">&#39;Total no disconnection&#39;</span><span class="p">]</span> <span class="o">-=</span> <span class="n">costs</span><span class="p">[</span><span class="s1">&#39;Arc&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">costs</span><span class="p">[</span><span class="s1">&#39;Node&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">costs</span><span class="p">[</span><span class="s1">&#39;Space Prep&#39;</span><span class="p">]</span>
                    <span class="n">costs</span><span class="p">[</span><span class="s1">&#39;Arc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
                    <span class="n">costs</span><span class="p">[</span><span class="s1">&#39;Node&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
                    <span class="n">costs</span><span class="p">[</span><span class="s1">&#39;Space Prep&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
                    <span class="n">ne_results</span><span class="o">.</span><span class="n">results_layer</span><span class="p">[</span><span class="n">l</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;actions&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="n">ne_results</span><span class="o">.</span><span class="n">results_layer</span><span class="p">[</span><span class="n">l</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;run_time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">ne_results</span><span class="p">,</span> <span class="n">t_offset</span><span class="o">=</span><span class="n">t</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">save_results</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">save_object_to_file</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">save_results_to_file</span><span class="p">()</span></div>

<div class="viewcode-block" id="InfrastructureGame.set_out_dir"><a class="viewcode-back" href="../gameclasses.html#gameclasses.InfrastructureGame.set_out_dir">[docs]</a>    <span class="k">def</span> <span class="nf">set_out_dir</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">root</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        This function generates and sets the directory to which the results are written</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        root : str</span>
<span class="sd">            Root directory to write results</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        output_dir : str</span>
<span class="sd">            Directory to which the results are written</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">output_dir</span> <span class="o">=</span> <span class="n">root</span><span class="o">+</span><span class="s1">&#39;_L&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="p">))</span><span class="o">+</span><span class="s1">&#39;_m&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">magnitude</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;_v&quot;</span><span class="o">+</span>\
            <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="o">.</span><span class="n">sum_resource</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">judgments</span><span class="o">.</span><span class="n">judgment_type</span><span class="o">+</span>\
            <span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">res_alloc_type</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">res_alloc_type</span> <span class="o">==</span> <span class="s1">&#39;AUCTION&#39;</span><span class="p">:</span>
            <span class="n">output_dir</span> <span class="o">+=</span> <span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="o">.</span><span class="n">auction_model</span><span class="o">.</span><span class="n">auction_type</span><span class="o">+</span>\
                <span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="o">.</span><span class="n">auction_model</span><span class="o">.</span><span class="n">valuation_type</span>
        <span class="k">return</span> <span class="n">output_dir</span></div>

<div class="viewcode-block" id="InfrastructureGame.set_payoff_dir"><a class="viewcode-back" href="../gameclasses.html#gameclasses.InfrastructureGame.set_payoff_dir">[docs]</a>    <span class="k">def</span> <span class="nf">set_payoff_dir</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">root</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        This function generates and sets the directory to which the past results</span>
<span class="sd">        were written, from which the payoffs for the first time step are read</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        root : str</span>
<span class="sd">            Root directory to read past results</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        payoff_dir : str</span>
<span class="sd">            Directory from which the payoffs are read</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">root</span><span class="p">:</span>
            <span class="n">payoff_dir</span> <span class="o">=</span> <span class="n">root</span><span class="o">+</span><span class="s1">&#39;_L&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="p">))</span><span class="o">+</span><span class="s1">&#39;_m&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">magnitude</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;_v&quot;</span><span class="o">+</span>\
                <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="o">.</span><span class="n">sum_resource</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">judgments</span><span class="o">.</span><span class="n">judgment_type</span><span class="o">+</span>\
                <span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">res_alloc_type</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">res_alloc_type</span> <span class="o">==</span> <span class="s1">&#39;AUCTION&#39;</span><span class="p">:</span>
                <span class="n">payoff_dir</span> <span class="o">+=</span> <span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="o">.</span><span class="n">auction_model</span><span class="o">.</span><span class="n">auction_type</span><span class="o">+</span>\
                    <span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="o">.</span><span class="n">auction_model</span><span class="o">.</span><span class="n">valuation_type</span>
            <span class="k">return</span> <span class="n">payoff_dir</span><span class="o">+</span><span class="s1">&#39;/objs_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sample</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;.pkl&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="InfrastructureGame.set_network"><a class="viewcode-back" href="../gameclasses.html#gameclasses.InfrastructureGame.set_network">[docs]</a>    <span class="k">def</span> <span class="nf">set_network</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Checks if the network object exists, and if so, make a deepcopy of it to</span>
<span class="sd">        preserve the initial netowrk object as the initial netowrk object is used for</span>
<span class="sd">        all simulations , and must not be altered</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        params : dict</span>
<span class="sd">            Dictionary of input paramters</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        :class:`~infrastructure.InfrastructureNetwork`</span>
<span class="sd">            Network Object</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="s2">&quot;N&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s1">&#39;No initial network object for: &#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">judge_type</span><span class="o">+</span><span class="s1">&#39;, &#39;</span><span class="o">+</span>\
                     <span class="bp">self</span><span class="o">.</span><span class="n">res_alloc_type</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;N&quot;</span><span class="p">])</span> <span class="c1">#!!! deepcopy</span></div>

<div class="viewcode-block" id="InfrastructureGame.set_time_steps"><a class="viewcode-back" href="../gameclasses.html#gameclasses.InfrastructureGame.set_time_steps">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">set_time_steps</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">num_iter</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Checks if the window length is equal to one as the current version of</span>
<span class="sd">        games is devised based on itrative INDP</span>

<span class="sd">        .. todo::</span>
<span class="sd">            Games: Exapnd the code to imitate td-INDP</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        T : int</span>
<span class="sd">            Window lenght</span>
<span class="sd">        num_iter : TYPE</span>
<span class="sd">            Number of time steps</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        num_iter : int</span>
<span class="sd">            Number of time steps.</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">T</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span><span class="c1">#!!! to be modified in futher expansions</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s1">&#39;ERROR: T!=1, JC currently only supports iINDP, not td_INDP.&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">num_iter</span></div>

<div class="viewcode-block" id="InfrastructureGame.save_object_to_file"><a class="viewcode-back" href="../gameclasses.html#gameclasses.InfrastructureGame.save_object_to_file">[docs]</a>    <span class="k">def</span> <span class="nf">save_object_to_file</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Writes the object to file using pickle</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        sample : int</span>
<span class="sd">            Sample paramter of the current simulation</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        :</span>
<span class="sd">            None.</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_dir</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_dir</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_dir</span><span class="o">+</span><span class="s1">&#39;/objs_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sample</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;.pkl&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">output</span><span class="p">:</span>
            <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">output</span><span class="p">,</span> <span class="n">pickle</span><span class="o">.</span><span class="n">HIGHEST_PROTOCOL</span><span class="p">)</span></div>

<div class="viewcode-block" id="InfrastructureGame.save_results_to_file"><a class="viewcode-back" href="../gameclasses.html#gameclasses.InfrastructureGame.save_results_to_file">[docs]</a>    <span class="k">def</span> <span class="nf">save_results_to_file</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Writes results to file</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        sample : int</span>
<span class="sd">            Sample paramter of the current simulation</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        :</span>
<span class="sd">            None.</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">output_dir_agents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_dir</span><span class="o">+</span><span class="s1">&#39;/agents&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_dir</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_dir</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">output_dir_agents</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">output_dir_agents</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_dir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sample</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="o">.</span><span class="n">to_csv_layer</span><span class="p">(</span><span class="n">output_dir_agents</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sample</span><span class="p">)</span></div></div>
</pre></div>

           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, SISRRA.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>